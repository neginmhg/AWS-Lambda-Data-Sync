<div style="text-align: center;">
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/93/Amazon_Web_Services_Logo.svg" alt="AWS Logo" width="200"/>
    <img src="https://api.nuget.org/v3-flatcontainer/langchain/0.15.2/icon" alt="LangChain Logo" width="200"/>
    <img src="data:image/png;base64,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" alt="FASTAPI Logo" width="200"/>
    <h1>AWS Lambda Data Sync and LangChain</h1>
</div>



### Project Overview
**aws-lambda-data-sync** is an automated data processing pipeline designed for e-commerce applications. It triggers whenever new transaction data is uploaded to a designated S3 bucket, enabling real-time data aggregation and reporting. This project leverages AWS services such as Lambda, DynamoDB, RDS, and SNS to efficiently manage data aggregation, logging, error handling, and client notifications in a fully automated workflow.

### Key Features
- **Data Aggregation**: Automatically aggregates transaction data from uploaded files in S3.
- **Database Integration**: Posts aggregated data to an RDS database for easy access and reporting.
- **Error Handling**: Logs errors, notifies users, and reprocesses failed data uploads to ensure data integrity.
- **Notifications**: Sends client notifications about processing updates and errors via SNS.
- **Logging**: Records processing information and error details in DynamoDB for auditing purposes.

---

## Project Architecture
1. **S3 Bucket**: The `reprocess` bucket receives transaction data uploads, triggering the Lambda function.
2. **AWS Lambda**: Processes and aggregates transaction data; updates RDS, logs in DynamoDB, and sends notifications via SNS.
3. **RDS Database**: Stores the aggregated transaction data for analysis and reporting.
4. **DynamoDB**: Logs processing information and error details for transparency and troubleshooting.
5. **SNS**: Sends notifications to clients regarding processing updates and error alerts.

## Getting Started

### Prerequisites
- **AWS Account**: Ensure you have permissions for S3, Lambda, DynamoDB, RDS, and SNS.
- **IAM Role**: Create an IAM role with permissions to access S3, DynamoDB, SNS, and RDS. Attach this role to the Lambda function.
- **Database**: Set up a MySQL database on [db4free.net](https://www.db4free.net/).
  
### Setup Steps

1. **Create IAM Role for Lambda**:
   - Manually create an IAM role with necessary permissions for S3, DynamoDB, SNS, and RDS.
   - Attach this role to the Lambda function.

2. **Configure the Database**:
   - Set up the database on db4free.net and create the necessary tables using the `create_table_get_records_to_test` script.
   - Set the `CREATE_TABLE` flag to `True` in the script to initialize the tables.

3. **Create S3 Bucket**:
   - Create an S3 bucket (e.g., `reprocess-bucket`) and upload the CloudFormation template, Lambda layer, and Python code files.
   - Ensure that bucket permissions allow Lambda to read and write data.

4. **Deploy Resources using CloudFormation**:
   - Deploy the CloudFormation stack to create the resources defined in your templates.

5. **Subscribe to SNS Notifications**:
   - Subscribe clients to the SNS topic created by CloudFormation for notifications.

6. **Add S3 Trigger for Lambda**:
   - Manually add an S3 trigger to invoke the Lambda function on data upload events in the `reprocess` bucket.

7. **Run Tests**:
   - Upload sample transaction data to the S3 bucket to trigger the workflow and validate that the data is processed as expected.

8. **Validate Data in RDS**:
   - Use the `create_table_get_records_to_test` script with the `CREATE_TABLE` flag set to `False` to retrieve and validate records in the database.

---

## CloudFormation Template Structure

CloudFormation templates define resources such as:
- **S3 Bucket** for data storage.
- **Lambda Function** for data processing.
- **SNS Topic** for client notifications.
- **DynamoDB Table** for logging.
- **RDS Instance** for persistent storage.

Ensure all templates are organized and uploaded to the S3 bucket before deployment.

---

## API Endpoints

The following API endpoints are available for interacting with the e-commerce data processing system:

### 1. Upload Transaction File
- **Endpoint**: `POST /api/transactions/upload`
- **Description**: Allows clients to upload transaction files to the S3 bucket for processing.
- **Request**: Expects a file upload in the request body.
- **Response**: Returns a success message if the upload is successful.

### 2. Get Aggregated Transaction Data
- **Endpoint**: `GET /api/transactions`
- **Description**: Fetches aggregated transaction data from the RDS database.
- **Response**: Returns a list of aggregated transaction records.

### 3. Get Transaction Summary
- **Endpoint**: `GET /api/transactions/summary`
- **Description**: Provides a summary of transactions based on specified filters (e.g., date range, product category).
- **Query Parameters**: Optional filters can be provided in the request.
- **Response**: Returns a summary of transactions matching the filters.

### 4. Get Error Logs
- **Endpoint**: `GET /api/errors`
- **Description**: Retrieves error logs from DynamoDB to help diagnose processing issues.
- **Response**: Returns a list of error logs with details.

### 5. *POST Natural Language Queries*

- **Endpoint**: POST `/api/queries`
- **Description**: Allows users to query the database using natural language. The system interprets the natural language query and converts it into a structured SQL query to retrieve relevant data.
- **Response**: Returns a JSON object containing the results of the query, including details like product name, quantity, amount, and revenue.
---

## Usage

### Triggering the Workflow
1. **Upload Data**: Place transaction files in the `reprocess` S3 bucket. This action automatically triggers the Lambda function.
2. **Data Processing**: Lambda processes and aggregates the data, then posts it to RDS.
3. **Error Handling**: In case of errors, Lambda logs details to DynamoDB and places the erroneous data into an error bucket for later analysis.
4. **Client Notifications**: Clients are notified via SNS about the status of their uploads and any errors encountered during processing.